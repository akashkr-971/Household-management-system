<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Household Management System</title>
<style>
*{
    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
}
body {
    margin: 0;
    padding: 0;
    height:100%;
    background-color: rgb(199, 240, 226);
}
.top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: 80px;
    background-color: #333;
    color: #fff;
    padding: 0 0px;
}
.name {
    font-weight: 600;
    flex:4;
    text-align:center;
    display:flex;
    margin-left: 10%;
}
.acc {
    font-weight: 600;
    flex:2;
    text-align:center;
    display:flex;
    justify-content:center;
    height:80px;
}
span h3{
    position:relative;
    top:10px;
}
.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    z-index: 2;
}
.acc:hover .dropdown-content {
    display: block;
    top:80px;
    border-radius: 0 0 10px 10px;
    background-color: #333;
}
.dropdown-content:hover{
    display:block;
}
.dropdown-content a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}
.dropdown-content a:hover {
    background-color:black;
}
.mid-bar {
    margin-top: 40px;
    margin-bottom: 40px;
    padding: 20px;
    margin: 0;
}
.greet{
    font-size: 30px;
    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    margin: 10px 0 ;
    font-weight: 800;
}
.overlay {
    height: 100%;
    width: 100%;
    position: absolute;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 2;
}
.content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: white;
    z-index: 3;
    width: 80%;
    display: none;
}
.content1 { display: block; }
.content h4 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
}
.content h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
}
.content p {
    font-size: 1.2rem;
    margin-bottom: 2rem;
}
.content button {
    padding: 10px 20px;
    font-size: 1rem;
    background-color: #FFA500;
    border: none;
    color: white;
    cursor: pointer;
}
.uptask{
    text-align: center;
    width: 98%;
    height: 250px;
    font-size: 20px;
    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    font-weight: 600;
    background-color: blanchedalmond;
    border-radius: 10px;
    padding: 10px;
    overflow: auto;
}
.uptask p{
    margin: 0;
    padding-bottom: 10px;
}
table {
    width: 100%;
    border-collapse:collapse;
    border: 1px solid wheat;
    border-radius: 10px;
}
th, td {
    padding: 8px;
    text-align: center;
    border-bottom: 1px solid #ffcdcd;
    word-wrap: break-word;
}
th,tr {
    background-color: aliceblue;
}
tr:hover {
    background-color: #f5f5f5;
}
table button{
    height: 30px;
    width: 100%;
    border: none;
    background-color: #ddd;
    cursor: pointer;
    font-size: 16px;
}
.uptask, .services {
    margin-bottom:20px;
}
.services-tab{
    background-color: rgb(127, 240, 153);
    border-radius: 10px;
    margin-bottom:20px;
}
.services {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
    grid-gap: 20px;
    padding: 30px;
    margin: 0;
    height:auto;
    border-radius: 10px;
}
.services button{
    height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    color: #ffffff;
    padding: 0px;
}
.serviceitem{
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    height: 100%;
    border-radius: 10px;
    background-size: cover;
}
.servicetext{
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
}
.servicetext h3{
    margin-top: 10%;
}
.servicetext p{
    font-weight: 800;
}
.service1{
    background-image: url("{% static 'images/plumberimg.png' %}");

}
.service2{
    background-image: url("{% static 'images/electricianimg.png' %}");
}
.service3{
    background-image: url("{% static 'images/carpenterimg.png' %}");
}
.service4{
    background-image: url("{% static 'images/interiordesigner.png' %}");
}
.service5{
    background-image: url("{% static 'images/painterimg.png' %}");
}
.service6{
    background-image: url("{% static 'images/landscaperimg.png' %}");
}
a{
    text-decoration: none;
    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    font-size: 20px;
    color: #000;
}
button {
    height: 80px;
    width: 100%;
    border: none;
    background-color: #ddd;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
}
.cancel-btn{
    background-color: rgb(228, 49, 49);
    color: white;
}
.update-btn{
    background-color: rgba(215, 199, 20, 0.813);
    color: white;
    margin-bottom: 1px;
}
.complete-btn {
    background-color: #77dd77;
    color: white;
}
.pay-btn {
    background-color: #6495ed;
    color: white;
}
footer {
    width: 100%;
    height: 80px;
    background-color: #333;
    color: #fff;
    text-align: center;
    padding-top: 20px;
    font-size: 14px;
    position: relative;
    bottom: 0;
}
.cancellationform , .updateform{
    display: flex;
    position: absolute;
    background-color: rgb(243, 193, 193);
    padding: 20px;
    border-radius: 5px;
    z-index: 2;
    transform: translate(-50%, -50%);
}
.cancellationform{
    top: 50%;
    left: 50%;
}
.updateform{
    top: 50%;
    left: 50%;
    width:260px;
    height: 210px;
}
.updateform input{
    margin-bottom: 5px;
}
.cancellationform input[type="text"], .updateform input[type="text"]{
    height:30px;
    width: 200px;
}
.cancellationform input[type="submit"] ,.updateform input[type="submit"]{
    height:30px;
    width: 80px;
    background-color: rgb(61, 163, 246);
    color: white;
    border-radius: 10px;
    font-size: 18px;
    border: none;
}
.cancellationform input[type="button"] ,.updateform input[type="button"]{
    height:30px;
    width: 80px;
    background-color: rgb(255, 57, 57);
    color: white;
    border-radius: 10px;
    font-size: 18px;
    border: none;
}
.updateform input[type="time"],.updateform input[type="date"]{
    height:30px;
    width: 200px;
}
.viewcontainer{
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
}
.billcontainer{
    position: fixed;
    display: flex;
    flex-direction: column;
    height: auto;
    width: 600px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #77dd77;
    padding: 5px;
    padding-top: 20px;
    border-radius:10px;
    z-index: 2;
}
.billcontainer table{
    margin-top: 10px;
}
.fullbodyoverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8); 
    display: none;
    z-index: 1;
}
.bookingfulloverlay{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8); 
    display: flex;
}
.services button{
    padding: 0;
}
.services button a{
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
}
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4); 
    overflow: hidden;
}
.modal-content {
    background-color: #fefefe;
    padding: 20px;
    border: 1px solid #888;
    width: 40%;
    height: 70%;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    background-image: url('{% static "images/bkngimg.png" %}');
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;
}
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}
.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
label, input{
    font-size: 18px;
    height: 25px;
    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
}
input{
    margin-bottom: 20px;
    border-radius: 5px;
}
.bkgdetail{
    display: flex;
    justify-content: center;
    flex-direction: column;
}
.bkngformbutton{
    display: flex;
    justify-content: space-evenly;
    font-size: 20px;
    padding: 10px 30px;
}
.bkngformbutton button{
    height: 70px;
    width: 100px;
}
.bookingdetails{
    height: 200px;
    width: 500px;
    background-color: white;
    z-index: 10;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}
.bookingdetails tr{
    font-size: 20px;
}
.bookingdetails tr td{
    width: 50%;
}
.form-container {
    max-width: 800px;
    margin: auto;
    background-color:  blanchedalmond;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.form-container h2{
    text-align: center;
}

.review-form {
    display: flex;
    flex-direction: column;
}

.submit-btn {
    padding: 12px;
    background-color: #5cb85c;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
.submit-btn:hover {
    background-color: #4cae4c;
}
.submit-btn:active {
    background-color: #3e8e3e;
}
@media only screen and (max-width: 1400px) {
    .modal-content{
        width: 70%;
        height: 70%;
    }
}
</style>
</head>
<body>
<div class="fullbodyoverlay" id="fullbodyoverlay"></div>
<div class="top-bar">
    <div class="name">
        <p onclick="redirecttohome()">Household Management System</p>
        <script>
            function redirecttohome(){
                window.location.href="{% url 'home' %}"
            }
        </script>
    </div>
    <div class="acc">
        <span>
            <h3>Account</h3>
        </span>
        <div class="dropdown-content">
            <a href="{% url 'accountdetails' %}">Account Details</a>
            <a href="{% url 'orderhistory' %}">Order History</a>
            <a href="{% url 'resetpassword' %}">Reset password</a>
            <a href="{% url 'logout' %}">Logout</a>
        </div>
        
    </div>
</div>

<div class="mid-bar" id="mid-bar">
    <div class="greet">Welcome {{ user.user_name }}</div>
    <div class="uptask">
        <p>Upcoming Tasks</p>
        {% if user %}
        <table id="detailstable">
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Name</th>
                    <th>Job</th>
                    <th>Booking Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if user.homeowner.bookings.all%}
                    {% for booking in user.homeowner.bookings.all %}
                        {% if booking.status != 'Cancelled' and booking.status != 'Finished' and booking.status != 'Paid' %}
                        {% if booking.isupdated == 'No' %}
                            <tr onclick="Viewbooking('{{ booking.service_provider.user.full_name }}','{{ booking.job }}','{{ booking.service_provider.user.phone }}','{{ booking.servicedate }}','{{ booking.servicetime }}','{{ booking.isupdated }}')">
                        {% else %}
                        {% for update in booking.update_set.all %}
                            <tr onclick="Viewbooking('{{ booking.service_provider.user.full_name }}','{{ booking.job }}','{{ booking.service_provider.user.phone }}','{{ booking.servicedate }}','{{ booking.servicetime }}','{{ booking.isupdated }}','{{ update.description }}')">
                        {% endfor %}
                        {% endif %}
                                <td>{{ booking.booking_id }}</td>
                                <td>{{ booking.service_provider.user.full_name }}</td>
                                <td>{{ booking.job }}</td>
                                <td>{{ booking.status }}</td>
                                <td>
                                    {% if booking.status == 'Pending' %}
                                        <button class="update-btn" data-booking-id="{{ booking.booking_id }}" onclick="updatebooking('{{ booking.booking_id }}','{{ booking.homeowner.user.user_id }}','{{ booking.service_provider.service_provider_id }}'); event.stopPropagation();">Update</button>
                                        <button class="cancel-btn" data-booking-id="{{ booking.booking_id }}" onclick="cancelbooking('{{ booking.booking_id }}','{{ booking.homeowner.user.user_id }}','{{ booking.service_provider.service_provider_id }}'); event.stopPropagation();">Cancel</button>
                                    {% elif booking.status == 'Confirmed' %}
                                        <button class="update-btn" data-booking-id="{{ booking.booking_id }}" onclick="updatebooking('{{ booking.booking_id }}','{{ booking.homeowner.user.user_id }}','{{ booking.service_provider.service_provider_id }}'); event.stopPropagation();">Update</button>
                                        <button class="cancel-btn" data-booking-id="{{ booking.booking_id }}" onclick="cancelbooking('{{ booking.booking_id }}','{{ booking.homeowner.user.user_id }}','{{ booking.service_provider.service_provider_id }}'); event.stopPropagation();">Cancel</button>
                                    {% elif booking.status == 'Bill created' %}
                                        <button class="viewbill-btn" style="background-color: #20ed6b;" data-booking-id="{{ booking.booking_id }}" onclick="viewbill('{{ booking.booking_id }}',event)">View bill</button>
                                    {% else %}
                                        <p>Cancelled</p>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}                    
                    {% endfor %}
                    <tr id="msgbox" style="display: none;"><td colspan="5">No upcoming bookings available</td></tr>
                {% else %}
                <tr>
                    <td colspan="6">No upcoming bookings available</td>
                </tr>
                {% endif %}
            </tbody>
            <script>
                window.onload = function(){
                    maintable = document.getElementById('detailstable')
                    tbody = maintable.getElementsByTagName('tbody')[0]
                    msgbox = document.getElementById('msgbox')
                    console.log(tbody.rows.length)
                    if(tbody.rows.length === 1){
                        msgbox.style.display='table-row'
                    }
                    else{
                        msgbox.style.display='none'
                    }
                }

            </script>
        </table>     
        <div class="cancellationform" style="display: none;" id="cancellationform">
            <form method="post" action="{% url 'cancelbooking' %}">
                {% csrf_token %}
                <table class="canceltable" style="th{
                    width: 100%;
                }">
                    <tr><th colspan="2">Cancellation Reason</th></tr>
                    <tr>
                        <td colspan="2"><input type="text" name="cancellation_reason" required>
                        <input type="hidden" id="cancel_booking_id" name="booking_id">
                        <input type="hidden" id="cancel_homeownerid" name="homeownerid">
                        <input type="hidden" id="cancel_serviceproviderid" name="serviceproviderid"></td>
                    </tr>
                    <tr>
                        <td><input type="button" value="Cancel" onclick="closecancelform()"></td>
                        <td><input type="submit" value="Submit" name="submit"></td>
                    </tr>
                </table>
            </form>
            <script>
                function cancelbooking(bid,uid,sid){
                    document.getElementById('cancel_booking_id').value=bid;
                    document.getElementById('cancel_homeownerid').value=uid;
                    document.getElementById('cancel_serviceproviderid').value=sid;
                    document.getElementById('fullbodyoverlay').style.display='block'
                    document.getElementById('cancellationform').style.display='block';
                }
                function closecancelform(){
                    var cancellationform = document.getElementById('cancellationform')
                    cancellationform.style.display = 'none';
                    document.getElementById('fullbodyoverlay').style.display='none'
                }
            </script>
        </div>
        <div class="updateform" style="display: none;" id="Updateform">
            <form method="post" action=" {% url 'updatebooking' %} ">
                {% csrf_token %}
                <label for="updateDescription">Update Description:</label>
                <input type="text" id="updateDescription" name="update_description" required></input>
                <label for="updatetodate">Select date:</label>
                <input type="date" id="bookingDate" name="updatetodate" required></input>
                <label for="updatetotime">Select time:</label>
                <input type="time" id="bookingTime" name="updatetotime" required></input>
                <input type="hidden" name="booking_id" id="update_booking_id">
                <input type="hidden" name="homeowner_id" id="update_homeownerid">
                <input type="hidden" name="service_provider_id" id="update_serviceproviderid">
                <input type="button" value="cancel" onclick="closeupdateform()">
                <input type="submit" value="submit" name="submit">
            </form>
            <script>
                function updatebooking(bid,uid,sid){
                    document.getElementById('update_booking_id').value=bid;
                    document.getElementById('update_homeownerid').value=uid;
                    document.getElementById('update_serviceproviderid').value=sid;

                    document.getElementById('Updateform').style.display='block';
                    document.getElementById('fullbodyoverlay').style.display='block'
                }
                function closeupdateform(){
                    var cancellationform = document.getElementById('Updateform')
                    Updateform.style.display = 'none';
                    document.getElementById('fullbodyoverlay').style.display='none'
                }
            </script>
        </div>
        <div class="viewbooking" >
            <div class="viewcontainer" >
                <table id="viewtable" border="0" style="display: none;" >
                    <tr style="color: red;background-color: blue;"><th>Title</th><th> </th><th>Details</th></tr>
                    <tr><td>Name</td><td>:</td><td><label id="namelabel"></label></td></tr>
                    <tr><td>Job</td><td>:</td><td><label id="joblabel"></label></td></tr>
                    <tr><td>Phone number</td><td>:</td><td><label id="phonelabel"></label></td></tr>
                    <tr><td>Date</td><td>:</td><td><label id="datelabel"></label></td></tr>
                    <tr><td>Time</td><td>:</td><td><label id="timelabel"></label></td></tr>
                    <tr id="updated-data"><td>Description</td><td>:</td><td><label id="updatedisc"></label></td></tr>
                    <tr><td colspan="3"  style="padding: 0;"><input type="button" value="Close" onclick="closeviewform()" style="width: 80%;border-radius: 10px;background-color: rgb(246, 80, 80);color: white;height: 25px;font: 16px;"></td></tr>
                </table>
            </div>
            <script>
                function Viewbooking(uname,job,phone,date,time,updated,desc){
                    document.getElementById('namelabel').textContent=uname;
                    document.getElementById('joblabel').textContent=job;
                    document.getElementById('phonelabel').textContent=phone;
                    document.getElementById('datelabel').textContent=date;
                    document.getElementById('timelabel').textContent=time;
                    document.getElementById('fullbodyoverlay').style.display='block'
                    if(updated=='yes'){
                        document.getElementById('updated-data').style.display='table-row'
                        document.getElementById('updatedisc').textContent=desc;

                    }
                    else{
                        document.getElementById('updated-data').style.display='none'
                    }

                    viewtable=document.getElementById('viewtable')
                    viewtable.style.display='block'
                }
                function closeviewform(){
                    var viewtable = document.getElementById('viewtable')
                    viewtable.style.display = 'none';
                    document.getElementById('detailstable').style.opacity = "1";
                    document.getElementById('fullbodyoverlay').style.display='none'
                }
            </script>
        </div>
        <div class="viewbill">
            <div class="billcontainer" id="billcontainer" style="display: none;" >
                <form action="{% url 'initiate_payment' %}" method="post">
                    {%csrf_token%}
                    <label>Service Bill</label>
                    <input type="hidden" id="billbookingid" name="billbookingid">
                    <input type="hidden" name="userid" value={{user.user_id}}>
                    <input type="hidden" id="totalamountinput" name="totalamountinput">
                    <button onclick="printBill(event)" style="background-color: blue; color: white;height: 30px;width: 60px;float: right;">Print</button>
                    <div id="billImageContainer"></div>
                    <table class="billtable" id="billtable">
                        <thead>
                            <th>Description</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Amount</th>
                        </thead>
                        <tbody>
                            <tr id="totalrow">
                                <td colspan="2">The Total price is</td>
                                <td colspan="2"><label id="totalbilllabel"></label></td>
                            </tr>
                            <tr id="buttons">
                                <td colspan="2"><button onclick="closebill(event)" style="background-color: red;color: white;">Close</button></td>
                                <td colspan="2"><button id="rzp-button1" style="background-color: rgb(60, 255, 109);color: white;">Pay</button></td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <script>
                function viewbill(billbid,event){
                    event.preventDefault()
                    event.stopPropagation(); 
                    document.getElementById('billbookingid').value=billbid;
                    document.getElementById('fullbodyoverlay').style.display='block';
                    document.getElementById('billcontainer').style.display='block';
                    fetchbill();
                }
                function closebill(event){
                    event.preventDefault()
                    event.stopPropagation();
                    document.getElementById('fullbodyoverlay').style.display='none';
                    document.getElementById('billcontainer').style.display='none'
                    const billtable = document.getElementById('billtable').getElementsByTagName('tbody')[0];
                    billtable.innerHTML=''
                    totalrow = document.getElementById('totalrow')
                    billtable.appendChild(totalrow)
                    buttons = document.getElementById('buttons')
                    billtable.appendChild(buttons)
                }
                function fetchbill(){
                    const bid=document.getElementById('billbookingid').value
                    console.log('button clicked the value is : ',bid)
                    const billtable = document.getElementById('billtable').getElementsByTagName('tbody')[0];

                    fetch(`/getbill/${bid}/`).then(response => response.json())
                    .then(data => {
                        const totalamount = document.getElementById('totalbilllabel')
                        const totalamountinput = document.getElementById('totalamountinput')
                        const bill = data.bill;
                        totalamount.textContent = bill.total_amount
                        totalamountinput.value = bill.total_amount


                        bill.items.forEach(item=>{
                            const row = document.createElement('tr');
                            row.innerHTML=`
                            <td>${item.description}</td>
                            <td>${item.price}</td>
                            <td>${item.quantity}</td>
                            <td>${item.amount}</td>
                            `;
                            billtable.appendChild(row)
                        })
                        const imageContainer = document.getElementById('billImageContainer');
                            if (bill.bill_image_url) {
                                const imgElement = document.createElement('img');
                                imgElement.src = bill.bill_image_url;
                                imgElement.alt = "Bill Image";
                                imgElement.style.maxWidth = "100%";
                                imgElement.style.height = "auto";
                                
                                imageContainer.innerHTML = ''; // Clear any existing content
                                imageContainer.appendChild(imgElement);
                            } else {
                                imageContainer.innerHTML = 'No image available';
                            }
                    });
                    
                    populatetable()
                }
                function populatetable(){
                    billtable = document.getElementById('billtable')
                    totalrow = document.getElementById('totalrow')
                    billtable.appendChild(totalrow)
                    buttons = document.getElementById('buttons')
                    billtable.appendChild(buttons)
                }
                function printBill(event){
                    event.preventDefault()
                    event.stopPropagation();
                    document.getElementById('buttons').style.display = 'none';
                    window.print();
                    document.getElementById('buttons').style.display = 'table-row';
                }
            </script>
        </div>
        {% else %}
        <div class="loginalert">
            <p>Unlock the full potential of our service management platform with a simple login</p>
            <a href="{% url 'Userlogin' %}" class="loginalertmsg">Login to show upcoming booking details</a>
        </div>
        {% endif %}
    </div>
    <div class="services-tab">
        <div>
            <h1 style="text-align: center;padding-top: 20px;margin: 0;">Services We Provide</h1><br>
        </div>
        <div class="services" id="servicescontainer">
            <button onclick="showbookingform('Plumber')">
                <div class="serviceitem service1">
                    <div class="servicetext">
                        <h2>Plumbing</h2>
                        <h3>Fix leaks, unclog drains, and handle all your plumbing needs.</h3>    
                        <p>Click to book</p>
                    </div>
                </div>
            </button>
            <button onclick="showbookingform('Electrician')">
                <div class="serviceitem service2">
                    <div class="servicetext">
                        <h2>Electrician</h2>
                        <h3>Install, maintain, and repair electrical systems in your home.</h3>
                        <p>Click to book</p>
                    </div>
                </div>
            </button>
            <button onclick="showbookingform('Carpenter')">
                <div class="serviceitem service3">
                    <div class="servicetext">
                        <h2>Carpenter</h2>
                        <h3>Custom woodwork, repairs, and installations for your living spaces.</h3>
                        <p>Click to book</p>
                    </div>
                </div>
            </button>
            <button onclick="showbookingform('InteriorDesigner')">
                <div class="serviceitem service4">
                    <div class="servicetext">
                        <h2>Interior Designer</h2>
                        <h3>Custom woodwork, repairs, and installations for your living spaces.</h3>
                        <p>Click to book</p>
                    </div>
                </div> 
            </button>
            <button onclick="showbookingform('Painting')">
                <div class="serviceitem service5">
                    <div class="servicetext">
                        <h2>Painting</h2>
                        <h3>Refresh your home with expert interior and exterior painting services.</h3>
                        <p>Click to book</p>
                    </div>
                </div>
            </button>
            <button onclick="showbookingform('Landscaping')">
                <div class="serviceitem service6">
                    <div class="servicetext">
                        <h2>Landscaping</h2>
                        <h3>Create and maintain beautiful outdoor spaces for your property.</h3>
                        <p>Click to book</p>
                    </div>
                </div>
            </button>
        </div>
        <script>
            function showbookingform(job){
                document.getElementById('bookingFormModal').style.display='flex';
                document.getElementById('job').value=job;
            }
        </script>
        <div id="bookingFormModal"  class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeform()">&times;</span>
                <h1 style="text-align: center;">Booking Form</h1>
                {% if request.session.user_id %}
                    <form id="bookingForm" method='post' action="{% url 'bookings' %}">
                        {% csrf_token %}
                        <div class="bkgdetail">
                            <label for="username">User name : </label>
                            <input type="text" name="username" value="{{ user.user_name }}" required>

                            <label for="jobdesc">Job Description : </label>
                            <input type="text" name="jobdesc">

                            <label for="date">Date : </label>
                            <input type="date" name="date" id="bookingDateInForm" required>

                            <label for="time">Time : </label>
                            <input type="time" name="time" id="bookingTimeInForm" required>

                            <label for="location">location : </label>
                            <input type="text" name="location" required>

                            <label for="LandMark">LandMark : </label>
                            <input type="text" name="LandMark" required>

                            <input type="hidden" id="job" name="job">
                        </div>
                        
                        <div class="bkngformbutton">
                            <button type="button" onclick="closeform()" id="cancelBtn" style="background-color: rgb(247, 77, 77);"><label>Cancel</label></button>
                            <button type="submit" id="submitBtn" style="background-color: #20ed6b;"><label>Submit</label></button>
                        </div>
                    </form>
                {% else %}
                    <h3 style="text-align: center;padding: 30px;"><a href="{% url 'Userlogin'%}">Login to continue booking</a></h3>
                {% endif %}
            </div>
            <script>
                function closeform(){
                    var bookingFormModal = document.getElementById('bookingFormModal')
                    bookingFormModal.style.display = 'none';
                }
                window.addEventListener('click', function(event) {
                var bookingFormModal = document.getElementById('bookingFormModal');
                if (event.target == bookingFormModal) {
                    closeform();
                }
            });
             document.addEventListener('DOMContentLoaded', event => {
                    const datetime1 = document.getElementById('bookingDate');
                    const datetime2 = document.getElementById('bookingDateInForm');
                    const now = new Date();
                    now.setDate(now.getDate() + 1);
                    const formattedDate = now.toISOString().split('T')[0];
                    datetime1.setAttribute('min', formattedDate);
                    datetime1.addEventListener('click', () => {
                        datetime1.showPicker();
                    });
                    datetime2.setAttribute('min', formattedDate);
                    datetime2.addEventListener('click', () => {
                        datetime2.showPicker();
                    });
                });
                document.addEventListener('DOMContentLoaded', event => {
                    const timeInput1 = document.getElementById('bookingTime');
                    const timeInput2 = document.getElementById('bookingTimeInForm');
                    timeInput1.addEventListener('change', () => {
                        const selectedTime = timeInput1.value;
                        const [hours, minutes] = selectedTime.split(':').map(Number);
                        if ((hours >= 19 || hours < 7)) {
                            alert('Please select a time between 7:00 AM and 7:00 PM.');
                            timeInput1.value = '';
                        }
                    });
                    timeInput1.setAttribute('min', '07:00');
                    timeInput1.setAttribute('max', '19:00');
                    timeInput1.addEventListener('click', () => {
                        timeInput1.showPicker();
                    });
                    timeInput2.addEventListener('change', () => {
                        const selectedTime = timeInput2.value;
                        const [hours, minutes] = selectedTime.split(':').map(Number);
                        if ((hours >= 19 || hours < 7)) {
                            alert('Please select a time between 7:00 AM and 7:00 PM.');
                            timeInput2.value = '';
                        }
                    });
                    timeInput2.setAttribute('min', '07:00');
                    timeInput2.setAttribute('max', '19:00');
                    timeInput2.addEventListener('click', () => {
                        timeInput2.showPicker();
                    });
                });
            </script>
        </div>
    </div>
    {% if messages %}
        {% for message in messages %}
            {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                <div class="bookingfulloverlay" id="bookingfulloverlay"></div>
                <div class="bookingdetails" id="bookingdetails">
                    <table>
                        <th colspan="2">Booking Details</th>
                        <tr><td>Name</td><td id="providerName"></td></tr>
                        <tr><td>Phone</td><td id="providerNumber"></td></tr>
                        <tr><td>Date</td><td id="serviceDate"></td></tr>
                        <tr><td>Rate/unit</td><td id="serviceRate"></td></tr>
                        <tr><td>Rating</td><td id="providerRating"></td></tr>
                        <tr><td colspan="2"><button onclick="closedetailsform()" style="background-color: rgb(250, 34, 34); color: white; width: 60%;">close</button></td></tr>
                    </table>
                </div>
                <script>
                    var bookingData = JSON.parse('{{ message.message|escapejs }}');
                    document.getElementById('providerName').textContent = bookingData.providername;
                    document.getElementById('providerNumber').textContent = bookingData.providernumber;
                    document.getElementById('serviceDate').textContent = bookingData.servicedate;
                    document.getElementById('serviceRate').textContent = bookingData.servicerate + '/' + bookingData.rateunit;
                    document.getElementById('providerRating').textContent = bookingData.providerrating+'★';
                </script>
            {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                <div class="bookingfulloverlay" id="bookingfulloverlay"></div>
                <div class="bookingdetails" id="bookingdetails">
                    <div>
                        <h2>Sorry for the inconvenience</h2>
                        <h3>{{ message }}</h3>
                        <button onclick="closedetailsform()" style="background-color: rgb(250, 34, 34); color: white; width: 40%;height:30px;">close</button>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        <script>
            function closedetailsform(){
                document.getElementById('bookingdetails').style.display='none';
                document.getElementById('bookingfulloverlay').style.display='none';
            }
        </script>
    {% endif %}
<div class="form-container">
    <h2>Submit Your Review</h2>
    <form action=" {% url 'sitereview' %} " method="POST" class="review-form">
        {% csrf_token %}
        <label for="name">Your Name:</label>
        <input type="text" id="name" name="sitereviewname" placeholder="Enter your name" required>

        <label for="review">Your Review:</label>
        <textarea id="review" name="sitereview" placeholder="Enter your review here" required style="margin-bottom: 10px;font-size: 20px;" rows="5"></textarea>

        <button type="submit" class="submit-btn">Submit</button>
    </form>
</div>
</div>
<footer>
    <h4>Contact us: askashkr971@gmail.com</h4>
</footer>
</body>
</html>
